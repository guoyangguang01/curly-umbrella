## CAS单点登录模块项目总结

本系统采用分布式架构的设计方案,在解决了传统集中式架构性能的问题同时,也带来了新的要处理的问题,传统的web应用分布于同一台主机之中,同一个请求只会有对应的一个应用来进行处理,只需要采用session会话技术即可满足需求,而分布式架构中各个服务的部署分布于不同的网络节点上,每个应用的ip地址都有可能不同,这时使用服务器session会话来维持各应用间的登录状态便不再可取,为了解决各应用节点之间的登录状态同步问题,我们选用了CAS服务器与springSecrity模块的整合来实现整个系统的单点登录功能,CAS模块的通信过程如下:

1. 当用户向服务器发送登录请求或是访问必须要求用户登录状态的模块时,对应的服务会通过filter过滤器验证用户是否登录,若验证通过则直接提供服务,否则将请求转发到CAS服务器
2. CAS服务器接到登录请求,将用户转到登录界面
3. 用户登录成功后,cas会在服务器中存储一个大令牌(TGT,),会将请求转发回之前请求的服务器,同时携带ST(Service Ticket,使用一次即可生效)返回给服务器,同时返回TGC作为cookie存储在浏览器中(TGC只会在访问CAS服务器是才会被携带)
4. 当用户再次发起一个请求访问url时,filter过滤器会在服务器session中发现该用户的信息予以放行
5. 当用户请求另一个服务时,服务同样会将请求转发到CAS服务器,这是请求中会携带TGC票据,CAS识别到用户携带的TGC后不会跳转到登录界面,而是直接选择使用TGT生成ST,并将请求转发到之前的服务中,这是服务中的session会与请求的sessionID进行匹配,filter放行,成功完成请求
6. 当用户选择退出登录或CAS服务器中的TGT过期时,CAS会向所有的关联服务发送消息,清除掉所有关联服务上的该用户的ST信息

CAS与springSecurity的整合

在使用CAS提供单点登录功能后,springSecurity将不再负责用户账号密码的校验功能,只需要提供用户的角色查询功能即可,同时为了保持登录界面与整个系统界面的风格一致,我们修改了CAS的登录界面,使页面的跳转更加的自然平滑.